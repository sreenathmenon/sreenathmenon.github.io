!function(a,b){"use strict";function c(a,b){var c,e,f={backup_files:z.find(".backup_files input:checked").val(),backup_db:z.find(".backup_db input:checked").val()},g=["backup_files","backup_db"];a===!0&&(z.find(".backup_db .js-yes").attr("checked","checked"),f.backup_db="yes"),b===!0&&(z.find(".backup_files .js-yes").attr("checked","checked"),f.backup_files="yes");for(var h=0;h<g.length;h++)e=!1,A.find(".type-"+g[h]).length>0&&(e=!0),e===!1&&"yes"==f[g[h]]?(c={},c.type=g[h],c.updaterAction="Backup","backup_db"==g[h]&&a===!0&&(c.status="forced"),"backup_files"==g[h]&&b===!0&&(c.status="forced"),d(c)):e===!0&&"no"==f[g[h]]&&A.find(".type-"+g[h]).remove()}function d(a){var b,d="after";a.id=Updater.generateRandomString(),"undefined"==typeof a.status&&(a.status="queued"),"ee"==a.type&&c(!0,!0),("backup_files"==a.type||"backup_db"==a.type)&&(d="before"),b=Updater.Templates.action_row(a),A.find(".js-no_actions").hide(),"after"==d?A.find(".type-ee").length>0?A.find(".type-ee").before(b):A.append(b):A.prepend(b),A.find("tr.action:not(.type-backup_db,.type-backup_files)").length>0&&z.find("button.start_action").removeAttr("disabled").removeClass("disabled"),D[a.id]=a,f()}function e(){var a=Updater.Templates.action_row(B);b("#"+B.id).replaceWith(a),A.sortable("update")}function f(){A.sortable({items:"> .action:not(.type-ee)",handle:".move"})}function g(){var a,b,c=A.find("tr.status-forced, tr.status-queued");if(0===c.length)return!1;if(a=c.first(),b=a.attr("id"),"undefined"==typeof D[b])return!1;if("queued"!=D[b].status&&"forced"!=D[b].status)return!1;switch(D[b].type){case"backup_files":h(b);break;case"backup_db":j(b);break;case"addon":case"ee_forum":case"ee_msm":case"cp_theme":case"forum_theme":l(b);break;case"ee":n(b)}}function h(a){B=D[a],B.status="processing",B.loadingMsg="Preparing Files Backup",e(),b.ajax({url:Updater.ACT_URL+"&task=backup_files_prepare&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{XID:Updater.getXID(),auth_key:Updater.AUTH_KEY,time:E},error:function(a){Updater.setXID(a),v(a)},success:function(a,b,c){Updater.setXID(c),G=a.dirs,i(0)}})}function i(a){var c;return 0===a&&(B.progressMsg="&nbsp;",delete B.loadingMsg,e()),"undefined"==typeof G[a]?(B.status="done",delete B.progressMsg,e(),void g()):(c=100/G.length*a,b("#single_action_progress").css("width",c+"%"),b("#single_action_progress").find(".inner").html(G[a]),void b.ajax({url:Updater.ACT_URL+"&task=backup_files&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"backup",dir:G[a],time:E,XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(b,c,d){return Updater.setXID(d),"no"==b.success?void v(b.body):void i(a+1)}}))}function j(a){B=D[a],B.status="processing",B.loadingMsg="Preparing Files Backup",e(),b.ajax({url:Updater.ACT_URL+"&task=backup_database_prepare&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(a,b,c){Updater.setXID(c),F=a.tables,k(0)}})}function k(a){var c;return 0===a&&(B.progressMsg="&nbsp;",delete B.loadingMsg,e()),"undefined"==typeof F[a]?(B.status="done",delete B.progressMsg,e(),void g()):(c=100/F.length*a,b("#single_action_progress").css("width",c+"%"),b("#single_action_progress").find(".inner").html(F[a]),void b.ajax({url:Updater.ACT_URL+"&task=backup_database&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"backup",table:F[a],time:E,XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(b,c,d){return Updater.setXID(d),"no"==b.success?void v(b.body):void k(a+1)}}))}function l(a){B=D[a],B.status="processing",B.loadingMsg="Moving Files",e(),b.ajax({url:Updater.ACT_URL+"&task=addon_move_files&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{addon:JSON.stringify(B),XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(b,c,d){if(Updater.setXID(d),"no"==b.success)return void v(b.body);if(b.queries)for(var f=0;f<b.queries.length;f++)Updater.queries.push(b.queries[f]+";");return"addon"==B.type||"ee_forum"==B.type?void setTimeout(function(){m(a)},500):(B.status="done",delete B.loadingMsg,e(),g(),void x())}})}function m(){B.loadingMsg="install"==B.updaterAction?"Installing...":"Updating...",e(),b.ajax({url:Updater.MCP_AJAX_URL+"&task=addon_install&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{addon:JSON.stringify(B),XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(a,b,c){if(Updater.setXID(c),"no"==a.success)return void v(a.body);if(a.queries)for(var d=0;d<a.queries.length;d++)Updater.queries.push(a.queries[d]+";");B.status="done",delete B.loadingMsg,e(),g(),x()}})}function n(a){B=D[a],B.status="processing",B.loadingMsg="Putting site offline...",e(),b.ajax({url:Updater.ACT_URL+"&task=ee_update_init&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"site_offline",action_obj:JSON.stringify(B),XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(a,b,c){return Updater.setXID(c),"no"==a.success?void v(a.body):void o()}})}function o(){B.loadingMsg="Copying installer files...",e(),b.ajax({url:Updater.ACT_URL+"&task=ee_update_init&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"copy_installer",action_obj:JSON.stringify(B),XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a),v(a)},success:function(a,b,c){return Updater.setXID(c),"no"==a.success?void v(a.body):(H=a.updates,C=a.server,0===H.length?void p():void p())}})}function p(a){a?a++:a=1,B.loadingMsg="Waiting for server to respond. Attempts: "+a,e(),b.ajax({url:J+"index/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(B),server:C},timeout:3e3,error:function(){setTimeout(function(){p(a)},1e3)},success:function(b){b&&b.success?q():setTimeout(function(){p(a)},1e3)}})}function q(){B.loadingMsg="Preparing Files Copy",e(),b.ajax({url:J+"copy_files_prepare/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(B),server:C},error:function(a){v(a)},success:function(a){return"no"==a.success?void v(a.body):(I=a.dirs,void r(0))}})}function r(a){var c;return 0===a&&(B.progressMsg="Preparing Files Copy",delete B.loadingMsg,e()),"undefined"==typeof I[a]?(delete B.progressMsg,void s(0)):(c=100/I.length*a,b("#single_action_progress").css("width",c+"%"),b("#single_action_progress").find(".inner").html(I[a]),void b.ajax({url:J+"copy_files/"+encodeURIComponent(I[a].replace(/\//g,"-"))+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{dir:I[a],action_obj:JSON.stringify(B),server:C},error:function(a){v(a)},success:function(b){return"no"==b.success?void v(b.body):void r(a+1)}}))}function s(a){return"undefined"==typeof H[a]?(delete B.loadingMsg,void t()):(B.loadingMsg="Updating to: "+H[a].label,e(),void b.ajax({url:J+"update_ee/"+H[a].version+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{version:H[a].version,action_obj:JSON.stringify(B),server:C},error:function(a){v(a)},success:function(b){if(null===b)return void v("UNKNOWN ERROR");if(b.queries)for(var c=0;c<b.queries.length;c++)Updater.queries.push(b.queries[c]+";");return"no"==b.success?void v(b.body):void s(a+1)}}))}function t(){B.loadingMsg="Executing module update routines...",e(),b.ajax({url:J+"update_modules/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(B),server:C},error:function(a){v(a)},success:function(a){if("no"==a.success)return void v(a.body);if(a.queries)for(var b=0;b<a.queries.length;b++)Updater.queries.push(a.queries[b]+";");u()}})}function u(){B.loadingMsg="Removing installer files...",e(),x(),b.ajax({url:J+"cleanup/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(B),server:C},error:function(a){v(a)},success:function(){B.status="done",delete B.loadingMsg,e()}})}function v(b){"undefined"!=typeof b.responseText?(B.errorMsg="Unexpected server response, probably a PHP error.",B.errorDetail=a.btoa(b.responseText)):B.errorMsg=b,B.status="error",delete B.loadingMsg,delete B.progressMsg,e()}function w(a){b("#error_log").hide(),b(a.target).closest(".action").removeAttr("status-error").addClass("status-queued"),delete B.errorMsg,delete B.errorDetail,"ee"==B.type?(B.status="processing",e(),p()):(B.status="queued",e(),g())}function x(){Updater.queries.length>0&&z.find("a.queries_exec").show().find(".total").html(Updater.queries.length)}function y(a){a.preventDefault(),b("#queries_executed").slideDown(),b("html, body").stop().animate({scrollTop:b("#queries_executed").offset().top},1e3),b("#queries_executed").find("textarea").html(Updater.queries.join("\n"))}var z,A,B,C,Updater=a.Updater=a.Updater||{},D={},E=(new Date).getTime()/1e3,F=[],G=[],H=[],I=[],J=window.location.protocol+"//"+window.location.host+window.location.pathname+"?/dupdater/";Updater.processInit=function(){document.getElementById("actions_queue")&&(z=Updater.Wrap,A=b("#actions_queue"),z.delegate(".backup_db input, .backup_files input","click",c),c(),z.find(".start_action").click(g),z.delegate(".queries_exec","click",y),z.delegate(".js-retrybtn","click",w))},Updater.addProcessAction=function(a){for(var b,c,e,f=0;f<a.found.length;f++){if(e=[],b=a.found[f],"addon"==b.type||"cp_theme"==b.type||"forum_theme"==b.type)for(var g in b.info)e.push({type:b.type,info:b.info[g]});else e.push({type:b.type,info:b.info});for(var h=0;h<e.length;h++)c={},c.temp_dir=a.temp_dir,c.temp_key=a.temp_key,c.type=e[h].type,c.info=e[h].info,c.updaterAction=e[h].info.updater_action?e[h].info.updater_action:"update",d(c)}}}(window,jQuery),function(a,b){"use strict";function c(a,b){var c={id:b,filename:a.name,filesize:q(a.size,2),status:"queued"};w[b]=c;var d=Updater.Templates.upload_filerow(c);t.find(".js-no_files").hide(),t.append(d)}function d(a,c,d){var e=(c/(d/100)).toFixed(2)+"%";b("#"+a).find(".progress").css("width",e)}function e(){var a=document.createElement("input");a.setAttribute("multiple","multiple"),a.setAttribute("type","file"),a.setAttribute("accept",".zip"),b("#update_upload_placeholder").replaceWith(a),s.find("input").change(f),s.bind("dragover",function(a){a.preventDefault(),a.stopPropagation()}),s.bind("dragleave",function(a){a.preventDefault(),a.stopPropagation()}),s.bind("drop",function(a){a.stopPropagation(),a.preventDefault();for(var b=a.originalEvent.dataTransfer.files,d=0;d<b.length;d++){var e=Math.random().toString(36).substring(2);v[e]=b[d],c(b[d],e)}g()})}function f(a){for(var b=["zip"],d=0;d<a.target.files.length;d++){var e=a.target.files[d].name.toLowerCase().split(".").pop();if(!(b.indexOf(e)<0)){var f=Math.random().toString(36).substring(2);v[f]=a.target.files[d],c(a.target.files[d],f)}}g()}function g(){var a=t.find(".file").filter(".status-queued:first"),b=a.attr("id"),c=w[b];if(0===a.length)return delete v[b],!1;c.status="uploading",p(b,c);var e=new XMLHttpRequest;e.upload.onprogress=function(a){d(b,a.loaded,a.total)},e.onload=function(a){h(a,e,b)},e.open("post",u,!0),e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("X-File-Name",c.filename),e.setRequestHeader("X-File-Size",c.fileSize);var f=new FormData;f.append("XID",Updater.XID),f.append("auth_key",Updater.AUTH_KEY),f.append("updater_file",v[b]),e.send(f)}function h(b,c,e){d(e,100,100);var f,h=w[e];if(h.status="error",200==c.status){try{f=JSON.parse(c.responseText)}catch(i){return h.errorMsg="Unexpected server response, probably a PHP error.",h.errorDetail=a.btoa(c.responseText),void p(e,h)}if(f.error_msg)return h.errorMsg=f.error_msg,void p(e,h);if("no"==f.success)return h.errorMsg=f.error_msg,void p(e,h);h.status="done",p(e,h),Updater.addProcessAction(f)}else h.errorMsg="Server responded with a "+c.status+" status",h.errorDetail=a.btoa(c.responseText),p(e,h);g()}function i(){var c=120;b("#updater_upload").is(":visible")!==!1&&(c=b("#updater_upload").width()+10),y=new SWFUpload({flash_url:Updater.THEME_URL+"img/swfupload.swf",upload_url:a.location.protocol+u,post_params:{task:"upload_file",flash_upload:"yes",XID:Updater.XID,auth_key:Updater.AUTH_KEY},file_post_name:"updater_file",prevent_swf_caching:!0,assume_success_timeout:0,file_size_limit:0,file_types:"*.zip",file_types_description:".zip Files",file_upload_limit:0,file_queue_limit:0,swfupload_preload_handler:function(){},swfupload_load_failed_handler:function(){},file_dialog_start_handler:function(){},file_queued_handler:j,file_queue_error_handler:function(){},file_dialog_complete_handler:k,upload_resize_start_handler:function(){},upload_start_handler:l,upload_progress_handler:m,upload_error_handler:n,upload_success_handler:o,upload_complete_handler:function(){},button_image_url:"",button_placeholder_id:"update_upload_placeholder",button_width:c,button_height:28,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,debug:!0})}function j(a){return c(a,a.id,"")===!1?(this.cancelUpload(a.id,!1),!1):void 0}function k(){this.startUpload()}function l(a){var b=w[a.id];b.status="uploading",p(a.id,b)}function m(a,b,c){d(a.id,b,c)}function n(b,c,d){if("-270"!=c&&"-280"!=c){var e=w[b.id];e.status="error",e.errorMsg="Upload Failed: "+c+" MSG:"+d,e.errorDetail=a.btoa(serverData),p(b.id,e)}}function o(b,c){d(b.id,100,100);var e=w[b.id];e.status="error";try{serverData=JSON.parse(c)}catch(f){return e.errorMsg="Unexpected server response, probably a PHP error.",e.errorDetail=a.btoa(c),void p(b.id,e)}return"no"==serverData.success?(e.errorMsg=serverData.error_msg,void p(b.id,e)):(e.status="done",p(b.id,e),void Updater.addProcessAction(serverData))}function p(a,c){var d=Updater.Templates.upload_filerow(c);b("#"+a).replaceWith(d)}function q(a,b){var c=["b","KB","MB","GB","TB"];a=Math.max(a,0);var d=Math.floor((a?Math.log(a):0)/Math.log(1024));return d=Math.min(d,c.length-1),a/=Math.pow(1024,d),b="number"==typeof b?b:0,Math.round(a*Math.pow(10,b))/Math.pow(10,b)+" "+c[d]}var Updater=a.Updater=a.Updater||{};a.btoa||(a.btoa=a.base64.encode),a.atob||(a.atob=a.base64.decode);var r,s,t,u,v={},w={},x=document.createElement("input");x.type="file";var y,z="multiple"in x&&"undefined"!=typeof a.FormData;Updater.uploadInit=function(){document.getElementById("updater_upload")&&(r=Updater.Wrap,s=r.find(".dropregion"),t=b("#upload_queue"),u=Updater.ACT_URL+"&task=upload_file",b(document.body).bind("dragover",function(a){return a.preventDefault(),!1}),b(document.body).bind("drop",function(a){return a.preventDefault(),!1}),z?e():i())}}(window,jQuery),function(a,b){"use strict";function c(){var a=h.find("form").serializeArray(),c=h.find("td.login");c.removeClass("login-failed login-success").addClass("login-testing"),a.push({name:"XID",value:Updater.getXID()}),a.push({name:"auth_key",value:Updater.AUTH_KEY}),b.ajax({url:Updater.MCP_AJAX_URL+"&task=test_login",type:"POST",dataType:"json",data:a,success:function(a,b,d){Updater.setXID(d),c.removeClass("login-testing").addClass("yes"==a.success?"login-success":"login-failed")},error:function(a){Updater.setXID(a)}})}function d(){var a=h.find(".js-togglefiletransfer"),b=a.find("input:checked").val(),d=a.closest(".utable");d.find("tbody").hide(),d.find("tbody.js-"+b).show(),("sftp"==b||"ftp"==b)&&c()}function e(a){var c=b("#updater_folder_browse"),d=c.find(".btn-primary"),e=b(a.target).data("map");c.data("mapper",e),i.inputs=h.find("form").serializeArray(),i.loading_elem=c.find(".loading"),i.error_elem=c.find(".error"),i.modal=c,c.modal({backdrop:"static"}),f("chdir",""),d.data("attached")||(d.data("attached",!0),d.click(function(a){a.preventDefault();var b=c.find(".path input").val();h.find(".map-"+c.data("mapper")+" input").attr("value",b),c.modal("hide")}),c.delegate(".cdup","click",function(){f("cdup",c.find(".path input").val())}),c.delegate(".chdir","click",function(a){f("chdir",c.find(".path input").val()+b(a.target).html())}))}function f(a,c){i.error_elem.hide(),i.loading_elem.show(),b.ajax({url:Updater.MCP_AJAX_URL+"&task=browse_server",type:"POST",dataType:"json",data:{settings:i.inputs,path:c,action:a,XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},success:function(a,b,c){if(Updater.setXID(c),i.loading_elem.hide(),"no"==a.success)return void i.error_elem.show();a.path&&i.modal.find(".path input").attr("value",a.path);var d=Updater.Templates.browse_server(a.items);i.modal.find(".content").html(d)},error:function(a){Updater.setXID(a)}})}function g(){b.ajax({url:Updater.ACT_URL+"&task=get_server_info",dataType:"json",type:"POST",data:{XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(a){Updater.setXID(a)},success:function(a,b,c){Updater.setXID(c),Updater.Server=a.server;for(var d in Updater.Server)""===h.find(".map-"+d+" input").val()&&h.find(".map-"+d+" input").attr("value",Updater.Server[d])}})}var Updater=a.Updater=a.Updater||{},h={},i={};Updater.settingsInit=function(){if(document.getElementById("updater-settings")){h=Updater.Wrap,h.delegate(".js-togglefiletransfer","click",d),d(),h.delegate(".pathmap .browse","click",e);var a=0;h.delegate(".js-ftp, .js-sftp","keyup",function(){clearTimeout(a),a=setTimeout(function(){c()},500)}),h.delegate(".retest","click",c),g()}}}(window,jQuery),function(a,b){"use strict";function c(){b.ajax({url:Updater.SITE_URL+"#clean_temp_dirs",type:"POST",data:{XID:Updater.getXID(),auth_key:Updater.AUTH_KEY,ACT:Updater.ACT_ID,task:"clean_temp_dirs"},error:function(a){Updater.setXID(a)},success:function(a,b,c){Updater.setXID(c)}})}function d(a){a.preventDefault();var c=b("#test_transfer_method");c.css({width:"800px","margin-left":function(){return-(b(this).width()/2)}}).modal().find(".loading").show(),c.find(".wrapper").empty(),b.ajax({url:Updater.MCP_AJAX_URL,type:"POST",data:{XID:Updater.getXID(),auth_key:Updater.AUTH_KEY,ACT:Updater.ACT_ID,task:"test_transfer_method"},success:function(a,b,d){Updater.setXID(d),c.find(".loading").hide(),c.find(".wrapper").html(a)},error:function(a){Updater.setXID(a)}})}function e(c){c.preventDefault();var d=b("#error_log"),e=a.atob(b(c.target).closest(".error").find("textarea").val());d.slideDown(),d.find("body").empty(),b("html, body").stop().animate({scrollTop:d.offset().top},1e3),b('<iframe id="updater_error_iframe" style="width:100%;height:300px"/>').load(function(){b("#updater_error_iframe").contents().find("body").append(e)}).appendTo(d.find(".body"))}var Updater=a.Updater=a.Updater||{};Updater.queries=[],Updater.init=function(){Updater.Wrap=b("#updater"),Updater.uploadInit(),Updater.processInit(),Updater.settingsInit(),Updater.Wrap.delegate(".js-test_settings","click",d),Updater.Wrap.delegate(".js-show_error","click",e),Updater.TestAJAX(Updater.ACT_URL),c()},Updater.generateRandomString=function(){return Math.random().toString(36).substring(2)},Updater.getXID=function(){return Updater.XID?Updater.XID:EE.XID},Updater.setXID=function(a){var b=a.getResponseHeader("X-Updater-XID");b||(b=null),Updater.XID=b},Updater.TestAJAX=function(c){var d=b("#test_ajax_error");b.ajax({url:c+"&task=test_ajax_call",dataType:"json",type:"POST",data:{XID:Updater.getXID(),auth_key:Updater.AUTH_KEY},error:function(b){Updater.setXID(b),d.show(),d.find("a.url").attr("href",c).html(c),d.find(".error textarea").html(a.btoa(b.responseText)),0===b.status?d.find(".error .inner").html("<strong>Response Code:</strong> "+b.status+"&nbsp;&nbsp;&nbsp;<strong>Response Text</strong>: (Probably Cross-Domain AJAX Error)"):b.status>=200&&d.find(".error .inner").html("<strong>Response Code:</strong> "+b.status+"&nbsp;&nbsp;&nbsp;<strong>Response Text</strong>: "+b.statusText)},success:function(a,b,c){Updater.setXID(c),a||d.show()}})}}(window,jQuery),$(document).ready(function(){Updater.init()});
//# sourceMappingURL=mcp.min.map