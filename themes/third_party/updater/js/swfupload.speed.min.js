var SWFUpload;
"function"===typeof SWFUpload&&(SWFUpload.speed={},SWFUpload.prototype.initSettings=function(a){return function(c){"function"===typeof a&&a.call(this,c);this.ensureDefault=function(a,e){this.settings[a]=void 0==c[a]?e:c[a]};this.fileSpeedStats={};this.speedSettings={};this.ensureDefault("moving_average_history_size","10");this.speedSettings.user_file_queued_handler=this.settings.file_queued_handler;this.speedSettings.user_file_queue_error_handler=this.settings.file_queue_error_handler;this.speedSettings.user_upload_start_handler=
this.settings.upload_start_handler;this.speedSettings.user_upload_error_handler=this.settings.upload_error_handler;this.speedSettings.user_upload_progress_handler=this.settings.upload_progress_handler;this.speedSettings.user_upload_success_handler=this.settings.upload_success_handler;this.speedSettings.user_upload_complete_handler=this.settings.upload_complete_handler;this.settings.file_queued_handler=SWFUpload.speed.fileQueuedHandler;this.settings.file_queue_error_handler=SWFUpload.speed.fileQueueErrorHandler;
this.settings.upload_start_handler=SWFUpload.speed.uploadStartHandler;this.settings.upload_error_handler=SWFUpload.speed.uploadErrorHandler;this.settings.upload_progress_handler=SWFUpload.speed.uploadProgressHandler;this.settings.upload_success_handler=SWFUpload.speed.uploadSuccessHandler;this.settings.upload_complete_handler=SWFUpload.speed.uploadCompleteHandler;delete this.ensureDefault}}(SWFUpload.prototype.initSettings),SWFUpload.speed.fileQueuedHandler=function(a){if("function"===typeof this.speedSettings.user_file_queued_handler)return a=
SWFUpload.speed.extendFile(a),this.speedSettings.user_file_queued_handler.call(this,a)},SWFUpload.speed.fileQueueErrorHandler=function(a,c,b){if("function"===typeof this.speedSettings.user_file_queue_error_handler)return a=SWFUpload.speed.extendFile(a),this.speedSettings.user_file_queue_error_handler.call(this,a,c,b)},SWFUpload.speed.uploadStartHandler=function(a){if("function"===typeof this.speedSettings.user_upload_start_handler)return a=SWFUpload.speed.extendFile(a,this.fileSpeedStats),this.speedSettings.user_upload_start_handler.call(this,
a)},SWFUpload.speed.uploadErrorHandler=function(a,c,b){a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);SWFUpload.speed.removeTracking(a,this.fileSpeedStats);if("function"===typeof this.speedSettings.user_upload_error_handler)return this.speedSettings.user_upload_error_handler.call(this,a,c,b)},SWFUpload.speed.uploadProgressHandler=function(a,c,b){this.updateTracking(a,c);a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);if("function"===typeof this.speedSettings.user_upload_progress_handler)return this.speedSettings.user_upload_progress_handler.call(this,
a,c,b)},SWFUpload.speed.uploadSuccessHandler=function(a,c){if("function"===typeof this.speedSettings.user_upload_success_handler)return a=SWFUpload.speed.extendFile(a,this.fileSpeedStats),this.speedSettings.user_upload_success_handler.call(this,a,c)},SWFUpload.speed.uploadCompleteHandler=function(a){a=SWFUpload.speed.extendFile(a,this.fileSpeedStats);SWFUpload.speed.removeTracking(a,this.fileSpeedStats);if("function"===typeof this.speedSettings.user_upload_complete_handler)return this.speedSettings.user_upload_complete_handler.call(this,
a)},SWFUpload.speed.extendFile=function(a,c){var b;if(!a)return a;c&&(b=c[a.id]);b?(a.currentSpeed=b.currentSpeed,a.averageSpeed=b.averageSpeed,a.movingAverageSpeed=b.movingAverageSpeed,a.timeRemaining=b.timeRemaining,a.timeElapsed=b.timeElapsed,a.percentUploaded=b.percentUploaded,a.sizeUploaded=b.bytesUploaded):(a.currentSpeed=0,a.averageSpeed=0,a.movingAverageSpeed=0,a.timeRemaining=0,a.timeElapsed=0,a.percentUploaded=0,a.sizeUploaded=0);return a},SWFUpload.prototype.updateTracking=function(a,c){var b=
this.fileSpeedStats[a.id];b||(this.fileSpeedStats[a.id]=b={});c=c||b.bytesUploaded||0;0>c&&(c=0);c>a.size&&(c=a.size);var e=(new Date).getTime();if(b.startTime)if(b.startTime>e)this.debug("When backwards in time");else{var e=(new Date).getTime(),f=e-b.lastTime,g=c-b.bytesUploaded;if(0===g||0===f)return b;b.lastTime=e;b.bytesUploaded=c;b.currentSpeed=8*g/(f/1E3);b.averageSpeed=8*b.bytesUploaded/((e-b.startTime)/1E3);b.movingAverageHistory.push(b.currentSpeed);b.movingAverageHistory.length>this.settings.moving_average_history_size&&
b.movingAverageHistory.shift();b.movingAverageSpeed=SWFUpload.speed.calculateMovingAverage(b.movingAverageHistory);b.timeRemaining=8*(a.size-b.bytesUploaded)/b.movingAverageSpeed;b.timeElapsed=(e-b.startTime)/1E3;b.percentUploaded=100*(b.bytesUploaded/a.size)}else b.startTime=(new Date).getTime(),b.lastTime=b.startTime,b.currentSpeed=0,b.averageSpeed=0,b.movingAverageSpeed=0,b.movingAverageHistory=[],b.timeRemaining=0,b.timeElapsed=0,b.percentUploaded=c/a.size,b.bytesUploaded=c;return b},SWFUpload.speed.removeTracking=
function(a,c){try{c[a.id]=null,delete c[a.id]}catch(b){}},SWFUpload.speed.formatUnits=function(a,c,b,e){var f,g;if(0===a)return"0 "+b[b.length-1];if(e){f=a;g=b.length>=c.length?b[c.length-1]:"";for(e=0;e<c.length;e++)if(a>=c[e]){f=(a/c[e]).toFixed(2);g=b.length>=e?" "+b[e]:"";break}return f+g}var h=[],d=a;for(e=0;e<c.length;e++)a=c[e],g=b.length>e?" "+b[e]:"",f=d/a,f=e<c.length-1?Math.floor(f):f.toFixed(2),0<f&&(d%=a,h.push(f+g));return h.join(" ")},SWFUpload.speed.formatBPS=function(a){return SWFUpload.speed.formatUnits(a,
[1073741824,1048576,1024,1],["Gbps","Mbps","Kbps","bps"],!0)},SWFUpload.speed.formatTime=function(a){return SWFUpload.speed.formatUnits(a,[86400,3600,60,1],["d","h","m","s"],!1)},SWFUpload.speed.formatBytes=function(a){return SWFUpload.speed.formatUnits(a,[1073741824,1048576,1024,1],["GB","MB","KB","bytes"],!0)},SWFUpload.speed.formatPercent=function(a){return a.toFixed(2)+" %"},SWFUpload.speed.calculateMovingAverage=function(a){var c=[],b,e=0,f=0,g=0,h=0,d,j=0,k=0;b=a.length;if(8<=b){for(d=0;d<b;d++)c[d]=
a[d],e+=c[d];f=e/b;for(d=0;d<b;d++)g+=Math.pow(c[d]-f,2);h=Math.sqrt(g/b);for(d=0;d<b;d++)c[d]=(c[d]-f)/h;for(d=0;d<b;d++)2>=c[d]&&-2<=c[d]&&(k++,j+=a[d])}else{k=b;for(d=0;d<b;d++)j+=a[d]}return j/k});
